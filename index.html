<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TITAN ULTRA | SURVIVAL MESH</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
:root{--bg:#000;--a:#00ff88;--r:#ff0033}
body{margin:0;background:var(--bg);color:var(--a);font-family:monospace;height:100vh;display:flex;flex-direction:column}
#map{height:30vh}
#log{flex:1;overflow:auto;padding:8px;font-size:12px}
.msg{border:1px solid #033;padding:6px;margin:4px 0}
.out{border-color:var(--a)}
.in{border-color:#0f0}
.sos{border-color:var(--r);color:var(--r)}
#bar{display:flex;gap:5px;padding:5px;border-top:1px solid var(--a)}
button,input{background:#000;color:var(--a);border:1px solid var(--a);padding:6px}
#acceptBox{position:fixed;inset:0;background:#000d;display:none;align-items:center;justify-content:center}
#acceptCard{border:2px solid var(--a);padding:20px}
</style>
</head>

<body>

<div id="map"></div>
<div id="log"></div>

<div id="bar">
<input id="txt" placeholder="MESSAGE">
<button onclick="send()">SEND</button>
<button onclick="sos()">SOS</button>
<button onclick="showQR()">LINK</button>
</div>

<div id="acceptBox">
<div id="acceptCard">
<p>ðŸ“¡ INCOMING MESSAGE</p>
<button onclick="acceptMsg()">ACCEPT</button>
<button onclick="denyMsg()">DENY</button>
</div>
</div>

<div id="qrBox" style="display:none;position:fixed;inset:0;background:#000;justify-content:center;align-items:center"></div>

<script>
let pendingMsg=null;
let myId="NODE-"+Math.random().toString(36).substr(2,4);
let map,myMarker;

map=L.map('map',{zoomControl:false}).setView([22.57,88.36],13);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
myMarker=L.marker([0,0]).addTo(map);

navigator.geolocation.watchPosition(p=>{
 myMarker.setLatLng([p.coords.latitude,p.coords.longitude])
});

navigator.getBattery?.().then(b=>{
 b.onlevelchange=()=>log("ðŸ”‹ Battery: "+Math.round(b.level*100)+"%")
});

window.addEventListener("deviceorientation",e=>{
 if(e.alpha) log("ðŸ§­ Compass: "+Math.round(e.alpha)+"Â°")
});

function log(t,cls="in"){
 let d=document.createElement("div");
 d.className="msg "+cls;
 d.textContent=t;
 logBox.appendChild(d);
 logBox.scrollTop=logBox.scrollHeight;
}
const logBox=document.getElementById("log");

function send(){
 let v=txt.value;
 if(!v)return;
 let packet={from:myId,text:v,ts:Date.now()};
 localStorage.setItem("TITAN_MSG",JSON.stringify(packet));
 log("YOU: "+v,"out");
 txt.value="";
}

window.addEventListener("storage",e=>{
 if(e.key==="TITAN_MSG"){
  pendingMsg=JSON.parse(e.newValue);
  document.getElementById("acceptBox").style.display="flex";
 }
});

function acceptMsg(){
 document.getElementById("acceptBox").style.display="none";
 log("FROM "+pendingMsg.from+": "+pendingMsg.text,"in");
}

function denyMsg(){
 pendingMsg=null;
 document.getElementById("acceptBox").style.display="none";
}

function sos(){
 log("ðŸš¨ SOS SENT","sos");
}

function showQR(){
 let box=document.getElementById("qrBox");
 box.style.display="flex";
 box.innerHTML='<div id="qr"></div>';
 new QRCode(document.getElementById("qr"),location.href);
 box.onclick=()=>box.style.display="none";
}
</script>

</body>
</html>
